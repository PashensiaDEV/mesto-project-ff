(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function r(t,e,n,o){var r=p.querySelector(".places__item").cloneNode(!0),c=r.querySelector(".card__image"),a=r.querySelector(".like-counter");c.src=t.link,c.alt=t.name,a.textContent=t.likes.length,r.querySelector(".card__title").textContent=t.name,c.addEventListener("click",(function(){o(t)}));var i=r.querySelector(".card__delete-button"),u=r.querySelector(".card__like-button");return"119a34ebdcc16fb8071c44da"===t.owner._id?e(i,t):i.classList.add("card__delete-button-innactive"),t.likes.some((function(t){return"119a34ebdcc16fb8071c44da"===t._id}))&&u.classList.add("card__like-button_is-active"),n(u,t,a),r}function c(t){return fetch("".concat(l,"wff-cohort-38/cards/likes/").concat(t),{method:"PUT",headers:{authorization:d}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function a(t){return fetch("".concat(l,"wff-cohort-38/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:d}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}t.d({},{nC:()=>l,Js:()=>d,A2:()=>g,$4:()=>x,vs:()=>p,wS:()=>L,Gs:()=>s});var i=function(t,e){u(t)?(e.classList.add(s.inactiveButtonClass),e.disabled=!0):(e.classList.remove(s.inactiveButtonClass),e.disabled=!1)},u=function(t){return t.some((function(t){return!t.validity.valid}))},s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",errorClassDissable:".form__input-error"},l="https://nomoreparties.co/v1/",d="4601d008-a405-4f80-81df-1bf2249ca44f",p=document.querySelector("#card-template").content,f=document.querySelector(".places__list"),_=document.querySelector(".popup_type_image"),m=_.querySelector(".popup__image"),y=_.querySelector(".popup__caption"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=h.querySelector('form[name="new-place"]'),C=v.querySelector('form[name="edit-profile"]'),q=v.querySelector(".popup__input_type_name"),b=v.querySelector(".popup__input_type_description"),k=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_edit-avatar"),w=h.querySelector(".popup__input_type_card-name"),P=h.querySelector(".popup__input_type_url"),T="Сохранение...",A="Сохранить";function z(t){m.src=t.link,m.alt=t.name,y.textContent=t.name,e(_)}function D(t,o){t.addEventListener("click",(function(){var r=t.closest(".places__item"),c=document.querySelector(".popup_type_delete "),a=c.querySelector(".popup_button-delete");e(c),a.addEventListener("click",(function(){var t;(t=o._id,fetch("".concat(l,"wff-cohort-38/cards/").concat(t),{method:"DELETE",headers:{authorization:d}})).then((function(){r&&(r.remove(),n(c))}))}))}))}function O(t,e,n){t.addEventListener("click",(function(){var o=t.classList.contains("card__like-button_is-active");(o?a:c)(e._id).then((function(o){!function(t){t.classList.toggle("card__like-button_is-active")}(t),n.textContent=o.likes.length,e.likes=o.likes})).catch((function(t){console.error("Ошибка при ".concat(o?"удалении":"добавлении"," лайка:"),t)}))}))}k.addEventListener("click",(function(){b.value=g.textContent,q.value=L.textContent,e(v),function(t,e){var n=t.querySelectorAll(e.errorClassDissable),o=t.querySelectorAll(e.inputSelector);n.forEach((function(t){t.classList.remove(e.errorClass),t.textContent=""})),o.forEach((function(t){t.classList.remove(e.inputErrorClass)}))}(C,s)})),E.addEventListener("click",(function(){e(h)})),x.addEventListener("click",(function(){var t=j.querySelector(".popup__form"),o=j.querySelector(".popup__input");e(j),t.addEventListener("submit",(function(){var t,e,r;t=o.value,(e=j.querySelector(".button")).textContent=T,(r=t,fetch("".concat(l,"wff-cohort-38/users/me/avatar"),{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){x.style.backgroundImage="url(".concat(t.avatar,")"),n(j)})).catch((function(t){console.log(t)})).finally((function(){e.textContent=A}))}))})),document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&n(t)}))})),S.addEventListener("submit",(function(t){t.preventDefault();var e,o,c=h.querySelector(".button");c.textContent=T,(e=w.value,o=P.value,fetch("".concat(l,"wff-cohort-38/cards"),{method:"POST",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){var e=r({name:t.name,link:t.link,likes:t.likes,_id:t._id,owner:{_id:t.owner._id}},D,O,z);f.prepend(e),n(h),S.reset()})).catch((function(t){console.log(t)})).finally((function(){c.textContent=A}))})),C.addEventListener("submit",(function(t){t.preventDefault();var e,o,r=v.querySelector(".button");r.textContent=T,L.textContent=q.value,g.textContent=b.value,n(v),(e=q.value,o=b.value,fetch("".concat(l,"wff-cohort-38/users/me"),{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){L.textContent=t.name,g.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){r.textContent=A})),n(v)})),Array.from(document.querySelectorAll(s.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=Array.from(t.querySelectorAll(s.inputSelector)),n=t.querySelector(s.submitButtonSelector);i(e,n),e.forEach((function(o){o.addEventListener("input",(function(){(function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(s.inputErrorClass),n.classList.remove(s.errorClass),n.textContent=""}(t,e):function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(s.inputErrorClass),o.textContent=n,o.classList.add(s.errorClass)}(t,e,e.validationMessage)})(t,o),i(e,n)}))}))}(t)})),fetch("".concat(l,"wff-cohort-38/users/me"),{method:"GET",headers:{authorization:d}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){L.textContent=t.name,g.textContent=t.about,x.style.backgroundImage="url(".concat(t.avatar,")")})),fetch("".concat(l,"wff-cohort-38/cards"),{method:"GET",headers:{authorization:d}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){var e;e=r(t,D,O,z),f.append(e)}))}))})();